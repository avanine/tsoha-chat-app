<div id="thread-content">
  <div class="speech-bubble thread-content">
    <p>
      <strong>{{ selected_thread.creator }}</strong> {{ selected_thread.content
      }} {% if selected_thread.last_modified %}
      <span class="edited-tag"> (Edited)</span>
      {% endif %}
    </p>
    <p
      class="thread-date small"
      data-date="{{ selected_thread.created_at }}"
    ></p>
  </div>

  <div class="messages-list mt-4">
    {% if messages_in_thread %} {% for message in messages_in_thread %}
    <div class="speech-bubble {% if message.user_id == session.user_id %}message-sent{% endif %}">
      <p>
        <strong>{{ message.creator }}</strong> {{ message.content }} {% if
        message.last_modified %}
        <span class="edited-tag"> (Edited)</span>
        {% endif %}
      </p>
      <p class="thread-date small" data-date="{{ message.created_at }}"></p>
      {% if message.user_id == session.user_id %}

      <div class="dropdown kebab-menu">
        <button
          class="btn btn-link"
          type="button"
          id="messageMenu{{ message.id }}"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          <i class="fas fa-ellipsis-v grey-icon"></i>
        </button>
        <ul
          class="dropdown-menu dropdown-menu-end"
          aria-labelledby="messageMenu{{ message.id }}"
        >
          <li>
            <a class="dropdown-item" href="#" onclick="">Edit</a>
          </li>
          <li>
            <a class="dropdown-item text-danger" href="#" onclick="">Delete</a>
          </li>
        </ul>
      </div>
      {% endif %}
    </div>
    {% endfor %} {% endif %}
  </div>
</div>

<div class="new-message-form">
  <form
    action="/category/{{ category.id }}/thread/{{ selected_thread.id }}/add-message"
    method="POST"
  >
    <div class="mt-5">
      <textarea
        class="form-control"
        id="message-content"
        name="content"
        rows="3"
        placeholder="Write a new message..."
        required
      ></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Send</button>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dateElements = document.querySelectorAll(".thread-date");

    dateElements.forEach(function (element) {
      const rawDate = element.getAttribute("data-date");
      const formattedDate = new Date(rawDate).toLocaleString("en-US", {
        month: "long",
        day: "numeric",
        year: "numeric",
        hour: "numeric",
        minute: "numeric",
        hour12: true,
      });

      element.textContent = formattedDate;
    });
  });
</script>
